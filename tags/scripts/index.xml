<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Scripts on Asu1tty&#39;s Blog</title>
    <link>https://asu1tty.github.io/tags/scripts/</link>
    <description>Recent content from Asu1tty&#39;s Blog</description>
    <generator>Hugo</generator>
    <language>zh-cn</language>
    
    <managingEditor>unknow (Asu1tty)</managingEditor>
    <webMaster>unknow (Asu1tty)</webMaster>
    
    <copyright>本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！</copyright>
    
    <lastBuildDate>Mon, 17 Nov 2025 11:48:50 +0800</lastBuildDate>
    
    
    <atom:link href="https://asu1tty.github.io/tags/scripts/index.xml" rel="self" type="application/rss&#43;xml" />
    

    
    

    <item>
      <title>脚本记录</title>
      <link>https://asu1tty.github.io/post/scripts_colec/</link>
      <pubDate>Mon, 17 Nov 2025 11:48:50 &#43;0800</pubDate>
      <author>unknow (Asu1tty)</author>
      <guid>https://asu1tty.github.io/post/scripts_colec/</guid>
      <description>
        <![CDATA[<h1>脚本记录</h1><p>作者：Asu1tty（unknow）</p>
        
          <h2 id="1-java-层">
<a class="header-anchor" href="#1-java-%e5%b1%82"></a>
1. Java 层
</h2><h3 id="11-hashmap-相关的hook">
<a class="header-anchor" href="#11-hashmap-%e7%9b%b8%e5%85%b3%e7%9a%84hook"></a>
1.1. hashmap 相关的hook
</h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//由于有些请求头会使用这个添加，可能通过okhttp直接增加</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">var</span><span class="w"> </span><span class="n">hashMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Java</span><span class="p">.</span><span class="na">use</span><span class="p">(</span><span class="s">&#34;java.util.HashMap&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">hashMap</span><span class="p">.</span><span class="na">put</span><span class="p">.</span><span class="na">implementation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">console</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&#34;hashMap.put: &#34;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// java.util.concurrent.ConcurrentHashMap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">var</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Java</span><span class="p">.</span><span class="na">use</span><span class="p">(</span><span class="s">&#34;java.util.concurrent.ConcurrentHashMap&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ConcurrentHashMap</span><span class="p">.</span><span class="na">put</span><span class="p">.</span><span class="na">implementation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">console</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&#34;ConcurrentHashMap.put: &#34;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// java.util.LinkedHashMap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">var</span><span class="w"> </span><span class="n">LinkedHashMapClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Java</span><span class="p">.</span><span class="na">use</span><span class="p">(</span><span class="s">&#34;java.util.LinkedHashMap&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">LinkedHashMapClass</span><span class="p">.</span><span class="na">put</span><span class="p">.</span><span class="na">implementation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">console</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&#34;LinkedHashMap key:&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;value:&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span></code></pre></div><h3 id="12-url相关hook">
<a class="header-anchor" href="#12-url%e7%9b%b8%e5%85%b3hook"></a>
1.2. URL相关hook
</h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// hook java.net.URL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">var</span><span class="w"> </span><span class="n">URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Java</span><span class="p">.</span><span class="na">use</span><span class="p">(</span><span class="err">&#39;</span><span class="n">java</span><span class="p">.</span><span class="na">net</span><span class="p">.</span><span class="na">URL</span><span class="err">&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">URL</span><span class="p">.</span><span class="na">$init</span><span class="p">.</span><span class="na">overload</span><span class="p">(</span><span class="err">&#39;</span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">String</span><span class="err">&#39;</span><span class="p">).</span><span class="na">implementation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">console</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="err">&#39;</span><span class="n">java</span><span class="p">.</span><span class="na">net</span><span class="p">.</span><span class="na">URL</span><span class="w"> </span><span class="err">&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">$init</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//hook okhttp3 HttpUrl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">var</span><span class="w"> </span><span class="n">Builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Java</span><span class="p">.</span><span class="na">use</span><span class="p">(</span><span class="err">&#39;</span><span class="n">okhttp3</span><span class="p">.</span><span class="na">Request$Builder</span><span class="err">&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Builder</span><span class="p">.</span><span class="na">url</span><span class="p">.</span><span class="na">overload</span><span class="p">(</span><span class="err">&#39;</span><span class="n">okhttp3</span><span class="p">.</span><span class="na">HttpUrl</span><span class="err">&#39;</span><span class="p">).</span><span class="na">implementation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">url</span><span class="p">(</span><span class="n">a</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">console</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&#34;okhttp3.HttpUrl result: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="13-okhttp-拦截器">
<a class="header-anchor" href="#13-okhttp-%e6%8b%a6%e6%88%aa%e5%99%a8"></a>
1.3. okhttp 拦截器
</h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">showStacks</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">Exception</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;java.lang.Exception&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">ins</span> <span class="o">=</span> <span class="nx">Exception</span><span class="p">.</span><span class="nx">$new</span><span class="p">(</span><span class="s2">&#34;Exception&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">straces</span> <span class="o">=</span> <span class="nx">ins</span><span class="p">.</span><span class="nx">getStackTrace</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="kc">undefined</span> <span class="o">==</span> <span class="nx">straces</span> <span class="o">||</span> <span class="kc">null</span> <span class="o">==</span> <span class="nx">straces</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;============================= Stack strat=======================&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">straces</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="s2">&#34;   &#34;</span> <span class="o">+</span> <span class="nx">straces</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">toString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;============================= Stack end=======================\r\n&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Exception</span><span class="p">.</span><span class="nx">$dispose</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">array_list</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;java.util.ArrayList&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">TrustManagerImpl</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;com.android.org.conscrypt.TrustManagerImpl&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">TrustManagerImpl</span><span class="p">.</span><span class="nx">checkTrustedRecursive</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a1</span><span class="p">,</span> <span class="nx">a2</span><span class="p">,</span> <span class="nx">a3</span><span class="p">,</span> <span class="nx">a4</span><span class="p">,</span> <span class="nx">a5</span><span class="p">,</span> <span class="nx">a6</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// console.log(&#39;  --&gt; Bypassing TrustManagerImpl checkTrusted &#39;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">return</span> <span class="nx">array_list</span><span class="p">.</span><span class="nx">$new</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// console.log(&#39;[+] TrustManagerImpl&#39;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// console.log(&#39;[ ] TrustManagerImpl&#39;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Bypass OkHTTPv3 {4}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">const</span> <span class="nx">okhttp3_Activity_4</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;okhttp3.CertificatePinner&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">okhttp3_Activity_4</span><span class="p">[</span><span class="s1">&#39;check$okhttp&#39;</span><span class="p">].</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//    console.log(&#39;  --&gt; Bypassing OkHTTPv3 ($okhttp): &#39; + a);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// console.log(&#39;[+] OkHTTPv3 ($okhttp)&#39;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//    console.log(&#39;[ ] OkHTTPv3 ($okhttp)&#39;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 抓取 HttpURLConnection 请求和响应
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">var</span> <span class="nx">HttpURLConnection</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;java.net.HttpURLConnection&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">HttpURLConnection</span><span class="p">.</span><span class="nx">getInputStream</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getURL</span><span class="p">().</span><span class="nx">toString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">method</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getRequestMethod</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[*] HTTP Request: &#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 打印请求头
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">headers</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getRequestProperties</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">showStacks</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="nx">headers</span><span class="p">.</span><span class="nx">keySet</span><span class="p">().</span><span class="nx">toArray</span><span class="p">().</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="nx">headers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">).</span><span class="nx">toArray</span><span class="p">().</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[*] Header: &#39;</span> <span class="o">+</span> <span class="nx">key</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nx">values</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 打印请求体
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getDoOutput</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">outputStream</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getOutputStream</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;java.io.OutputStreamWriter&#39;</span><span class="p">)(</span><span class="nx">outputStream</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getLocalData</span><span class="p">().</span><span class="nx">toString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[*] Body: &#39;</span> <span class="o">+</span> <span class="nx">body</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">inputStream</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getInputStream</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 读取响应
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;java.io.InputStreamReader&#39;</span><span class="p">)(</span><span class="nx">inputStream</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">bufferedReader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;java.io.BufferedReader&#39;</span><span class="p">)(</span><span class="nx">reader</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">line</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="p">((</span><span class="nx">line</span> <span class="o">=</span> <span class="nx">bufferedReader</span><span class="p">.</span><span class="nx">readLine</span><span class="p">())</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">response</span> <span class="o">+=</span> <span class="nx">line</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[*] HTTP Response: &#39;</span> <span class="o">+</span> <span class="nx">response</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">inputStream</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 抓取 OkHttp 请求和响应
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">OkHttpClient</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;okhttp3.OkHttpClient&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">OkHttpClientBuilder</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;okhttp3.OkHttpClient$Builder&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">Interceptor</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;okhttp3.Interceptor&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">Response</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;okhttp3.Response&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">ResponseBody</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;okhttp3.ResponseBody&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 创建自定义的 Interceptor 实现
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">MyInterceptor</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">registerClass</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;com.custom.MyInterceptor&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="kr">implements</span><span class="o">:</span> <span class="p">[</span><span class="nx">Interceptor</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">intercept</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">chain</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">chain</span><span class="p">.</span><span class="nx">request</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">().</span><span class="nx">toString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                        <span class="kd">var</span> <span class="nx">method</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">method</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[*] OkHttp Request: &#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                        <span class="kd">var</span> <span class="nx">headers</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">showStacks</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">headers</span><span class="p">.</span><span class="nx">size</span><span class="p">();</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[*] Header: &#39;</span> <span class="o">+</span> <span class="nx">headers</span><span class="p">.</span><span class="nx">name</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nx">headers</span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="nx">i</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                        <span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;okio.Buffer&#39;</span><span class="p">).</span><span class="nx">$new</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                            <span class="nx">body</span><span class="p">.</span><span class="nx">writeTo</span><span class="p">(</span><span class="nx">buffer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                            <span class="kd">var</span> <span class="nx">requestBody</span> <span class="o">=</span> <span class="nx">buffer</span><span class="p">.</span><span class="nx">readUtf8</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[*] Body: &#39;</span> <span class="o">+</span> <span class="nx">requestBody</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                        <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">chain</span><span class="p">.</span><span class="nx">proceed</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                        <span class="c1">// 打印响应
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="kd">var</span> <span class="nx">responseBody</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">().</span><span class="nx">string</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[*] OkHttp Response: &#39;</span> <span class="o">+</span> <span class="nx">responseBody</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                        <span class="c1">// 需要重新创建响应，因为 response.body().string() 会消耗掉响应体
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="kd">var</span> <span class="nx">newResponseBody</span> <span class="o">=</span> <span class="nx">ResponseBody</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">().</span><span class="nx">contentType</span><span class="p">(),</span> <span class="nx">responseBody</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                        <span class="kd">var</span> <span class="nx">newResponse</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">newBuilder</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                            <span class="p">.</span><span class="nx">body</span><span class="p">(</span><span class="nx">newResponseBody</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                            <span class="p">.</span><span class="nx">build</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                        <span class="k">return</span> <span class="nx">newResponse</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Interceptor Error: &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                        <span class="k">throw</span> <span class="nx">e</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 重载 OkHttpClient.Builder 的 build 方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">OkHttpClientBuilder</span><span class="p">.</span><span class="nx">build</span><span class="p">.</span><span class="nx">overload</span><span class="p">().</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;[*] Adding interceptor to OkHttpClient&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="p">.</span><span class="nx">addInterceptor</span><span class="p">(</span><span class="nx">MyInterceptor</span><span class="p">.</span><span class="nx">$new</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">build</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Script successfully loaded&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Error: &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><h3 id="14-json相关">
<a class="header-anchor" href="#14-json%e7%9b%b8%e5%85%b3"></a>
1.4. JSON相关
</h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="c1">// JSON处理
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">jSONObject</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;org.json.JSONObject&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">jSONObject</span><span class="p">.</span><span class="nx">put</span><span class="p">.</span><span class="nx">overload</span><span class="p">(</span><span class="s1">&#39;java.lang.String&#39;</span><span class="p">,</span> <span class="s1">&#39;java.lang.Object&#39;</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;jSONObject.put: &#34;</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">jSONObject</span><span class="p">.</span><span class="nx">getString</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;jSONObject.getString: &#34;</span><span class="p">,</span> <span class="nx">a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getString</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;jSONObject.getString result: &#34;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">JSONObject</span><span class="p">[</span><span class="s1">&#39;optString&#39;</span><span class="p">].</span><span class="nx">overload</span><span class="p">(</span><span class="s1">&#39;java.lang.String&#39;</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">str</span> <span class="o">===</span> <span class="s2">&#34;data&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="nx">str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">getStackTraceString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="s1">&#39;optString&#39;</span><span class="p">](</span><span class="nx">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><h3 id="15-弹窗">
<a class="header-anchor" href="#15-%e5%bc%b9%e7%aa%97"></a>
1.5. 弹窗
</h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="line"><span class="cl"><span class="c1">// 弹窗关键类
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">toast</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;android.widget.Toast&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">toast</span><span class="p">.</span><span class="nx">show</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;toast.show: &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">Dialog</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;android.app.Dialog&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Hook show() 方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">Dialog</span><span class="p">.</span><span class="nx">show</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">Toast</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;android.widget.Toast&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">Toast</span><span class="p">.</span><span class="nx">makeText</span><span class="p">.</span><span class="nx">overload</span><span class="p">(</span><span class="s2">&#34;android.content.Context&#34;</span><span class="p">,</span> <span class="s2">&#34;java.lang.CharSequence&#34;</span><span class="p">,</span> <span class="s2">&#34;int&#34;</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">duration</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Toast message:&#34;</span><span class="p">,</span> <span class="nx">text</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 调用原始 makeText 方法生成 Toast
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">var</span> <span class="nx">toast</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">makeText</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">duration</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 返回生成的 Toast 对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="nx">toast</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><h3 id="16-sharedpreferences类相关">
<a class="header-anchor" href="#16-sharedpreferences%e7%b1%bb%e7%9b%b8%e5%85%b3"></a>
1.6. SharedPreferences类相关
</h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="line"><span class="cl"><span class="c1">// hook内部存储api，打印出存储的数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">sp</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;android.app.SharedPreferencesImpl$EditorImpl&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">sp</span><span class="p">.</span><span class="nx">putBoolean</span><span class="p">.</span><span class="nx">overload</span><span class="p">(</span><span class="s1">&#39;java.lang.String&#39;</span><span class="p">,</span> <span class="s1">&#39;boolean&#39;</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[SharedPreferencesImpl ] putBoolean -&gt; key: &#34;</span><span class="o">+</span><span class="nx">arg1</span><span class="o">+</span><span class="s2">&#34; = &#34;</span><span class="o">+</span><span class="nx">arg2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">putBoolean</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">sp</span><span class="p">.</span><span class="nx">putString</span><span class="p">.</span><span class="nx">overload</span><span class="p">(</span><span class="s1">&#39;java.lang.String&#39;</span><span class="p">,</span> <span class="s1">&#39;java.lang.String&#39;</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[SharedPreferencesImpl] putString -&gt; key: &#34;</span><span class="o">+</span><span class="nx">arg1</span><span class="o">+</span><span class="s2">&#34; = &#34;</span><span class="o">+</span><span class="nx">arg2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">putString</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">sp</span><span class="p">.</span><span class="nx">putInt</span><span class="p">.</span><span class="nx">overload</span><span class="p">(</span><span class="s1">&#39;java.lang.String&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[SharedPreferencesImpl] putInt -&gt; key: &#34;</span><span class="o">+</span><span class="nx">arg1</span><span class="o">+</span><span class="s2">&#34; = &#34;</span><span class="o">+</span><span class="nx">arg2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">putInt</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">sp</span><span class="p">.</span><span class="nx">putFloat</span><span class="p">.</span><span class="nx">overload</span><span class="p">(</span><span class="s1">&#39;java.lang.String&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[SharedPreferencesImpl] putFloat -&gt; key: &#34;</span><span class="o">+</span><span class="nx">arg1</span><span class="o">+</span><span class="s2">&#34; = &#34;</span><span class="o">+</span><span class="nx">arg2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">putFloat</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">sp</span><span class="p">.</span><span class="nx">putLong</span><span class="p">.</span><span class="nx">overload</span><span class="p">(</span><span class="s1">&#39;java.lang.String&#39;</span><span class="p">,</span> <span class="s1">&#39;long&#39;</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[SharedPreferencesImpl] putLong -&gt; key: &#34;</span><span class="o">+</span><span class="nx">arg1</span><span class="o">+</span><span class="s2">&#34; = &#34;</span><span class="o">+</span><span class="nx">arg2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">putLong</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// hook应用程序间数据传递的api，打印出传递数据的uri与具体的字段
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;android.content.ContentResolver&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">content</span><span class="p">.</span><span class="nx">insert</span><span class="p">.</span><span class="nx">overload</span><span class="p">(</span><span class="s2">&#34;android.net.Uri&#34;</span><span class="p">,</span><span class="s2">&#34;android.content.ContentValues&#34;</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[ContentResolver] *insert -&gt; Uri: &#34;</span><span class="o">+</span><span class="nx">arg1</span><span class="o">+</span><span class="s2">&#34;  Values: &#34;</span><span class="o">+</span><span class="nx">arg2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">content</span><span class="p">.</span><span class="k">delete</span><span class="p">.</span><span class="nx">overload</span><span class="p">(</span><span class="s2">&#34;android.net.Uri&#34;</span><span class="p">,</span><span class="s2">&#34;java.lang.String&#34;</span><span class="p">,</span><span class="s2">&#34;[Ljava.lang.String;&#34;</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">,</span><span class="nx">arg3</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[ContentResolver] *delete -&gt; Uri: &#34;</span><span class="o">+</span><span class="nx">arg1</span><span class="o">+</span><span class="s2">&#34;\n  -&gt; arg2: &#34;</span><span class="o">+</span><span class="nx">arg2</span><span class="o">+</span><span class="s2">&#34;\n  -&gt; arg3: &#34;</span><span class="o">+</span><span class="nx">arg3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">,</span><span class="nx">arg3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">content</span><span class="p">.</span><span class="nx">update</span><span class="p">.</span><span class="nx">overload</span><span class="p">(</span><span class="s1">&#39;android.net.Uri&#39;</span><span class="p">,</span><span class="s1">&#39;android.content.ContentValues&#39;</span><span class="p">,</span><span class="s1">&#39;java.lang.String&#39;</span><span class="p">,</span><span class="s1">&#39;[Ljava.lang.String;&#39;</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">,</span><span class="nx">arg3</span><span class="p">,</span><span class="nx">arg4</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[ContentResolver] *update -&gt; Uri: &#34;</span><span class="o">+</span><span class="nx">arg1</span><span class="o">+</span><span class="s2">&#34;\n  -&gt; arg2: &#34;</span><span class="o">+</span><span class="nx">arg2</span><span class="o">+</span><span class="s2">&#34;\n  -&gt; arg3: &#34;</span><span class="o">+</span><span class="nx">arg3</span><span class="o">+</span><span class="s2">&#34;\n  -&gt; arg4: &#34;</span><span class="o">+</span><span class="nx">arg4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">,</span><span class="nx">arg3</span><span class="p">,</span><span class="nx">arg4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">content</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">overload</span><span class="p">(</span><span class="s1">&#39;android.net.Uri&#39;</span><span class="p">,</span> <span class="s1">&#39;[Ljava.lang.String;&#39;</span><span class="p">,</span> <span class="s1">&#39;android.os.Bundle&#39;</span><span class="p">,</span> <span class="s1">&#39;android.os.CancellationSignal&#39;</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">,</span><span class="nx">arg3</span><span class="p">,</span><span class="nx">arg4</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[ContentResolver] *query -&gt; Uri: &#34;</span><span class="o">+</span><span class="nx">arg1</span><span class="o">+</span><span class="s2">&#34;\n  -&gt; arg2: &#34;</span><span class="o">+</span><span class="nx">arg2</span><span class="o">+</span><span class="s2">&#34;\n  -&gt; arg3: &#34;</span><span class="o">+</span><span class="nx">arg3</span><span class="o">+</span><span class="s2">&#34;\n  -&gt; arg4: &#34;</span><span class="o">+</span><span class="nx">arg4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">,</span><span class="nx">arg3</span><span class="p">,</span><span class="nx">arg4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">content</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">overload</span><span class="p">(</span><span class="s1">&#39;android.net.Uri&#39;</span><span class="p">,</span> <span class="s1">&#39;[Ljava.lang.String;&#39;</span><span class="p">,</span> <span class="s1">&#39;java.lang.String&#39;</span><span class="p">,</span> <span class="s1">&#39;[Ljava.lang.String;&#39;</span><span class="p">,</span> <span class="s1">&#39;java.lang.String&#39;</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">,</span><span class="nx">arg3</span><span class="p">,</span><span class="nx">arg4</span><span class="p">,</span><span class="nx">arg5</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[ContentResolver] *query -&gt; Uri: &#34;</span><span class="o">+</span><span class="nx">arg1</span><span class="o">+</span><span class="s2">&#34;\n  -&gt; arg2: &#34;</span><span class="o">+</span><span class="nx">arg2</span><span class="o">+</span><span class="s2">&#34;\n  -&gt; arg3: &#34;</span><span class="o">+</span><span class="nx">arg3</span><span class="o">+</span><span class="s2">&#34;\n  -&gt; arg4: &#34;</span><span class="o">+</span><span class="nx">arg4</span><span class="o">+</span><span class="s2">&#34;\n  -&gt; arg5: &#34;</span><span class="o">+</span><span class="nx">arg5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">,</span><span class="nx">arg3</span><span class="p">,</span><span class="nx">arg4</span><span class="p">,</span><span class="nx">arg5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">content</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">overload</span><span class="p">(</span><span class="s1">&#39;android.net.Uri&#39;</span><span class="p">,</span> <span class="s1">&#39;[Ljava.lang.String;&#39;</span><span class="p">,</span> <span class="s1">&#39;java.lang.String&#39;</span><span class="p">,</span> <span class="s1">&#39;[Ljava.lang.String;&#39;</span><span class="p">,</span> <span class="s1">&#39;java.lang.String&#39;</span><span class="p">,</span> <span class="s1">&#39;android.os.CancellationSignal&#39;</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">,</span><span class="nx">arg3</span><span class="p">,</span><span class="nx">arg4</span><span class="p">,</span><span class="nx">arg5</span><span class="p">,</span><span class="nx">arg6</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[ContentResolver] *query -&gt; Uri: &#34;</span><span class="o">+</span><span class="nx">arg1</span><span class="o">+</span><span class="s2">&#34;\n  -&gt; arg2: &#34;</span><span class="o">+</span><span class="nx">arg2</span><span class="o">+</span><span class="s2">&#34;\n  -&gt; arg3: &#34;</span><span class="o">+</span><span class="nx">arg3</span><span class="o">+</span><span class="s2">&#34;\n  -&gt; arg4: &#34;</span><span class="o">+</span><span class="nx">arg4</span><span class="o">+</span><span class="s2">&#34;\n  -&gt; arg5: &#34;</span><span class="o">+</span><span class="nx">arg5</span><span class="o">+</span><span class="s2">&#34;\n arg6: &#34;</span><span class="o">+</span><span class="nx">arg6</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span><span class="nx">arg2</span><span class="p">,</span><span class="nx">arg3</span><span class="p">,</span><span class="nx">arg4</span><span class="p">,</span><span class="nx">arg5</span><span class="p">,</span><span class="nx">arg6</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="17-usb-检测">
<a class="header-anchor" href="#17-usb-%e6%a3%80%e6%b5%8b"></a>
1.7. USB 检测
</h3><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">usb_anti</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Java</span><span class="p">.</span><span class="nx">enumerateClassLoadersSync</span><span class="p">().</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">classLoader</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Java</span><span class="p">.</span><span class="nx">classFactory</span><span class="p">.</span><span class="nx">loader</span> <span class="o">=</span> <span class="nx">classLoader</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nx">ArrayList</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;java.util.ArrayList&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nx">AccessibilityManager</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;android.view.accessibility.AccessibilityManager&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">AccessibilityManager</span><span class="p">[</span><span class="s2">&#34;getInstalledAccessibilityServiceList&#34;</span><span class="p">].</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">ArrayList</span><span class="p">.</span><span class="nx">$new</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">AccessibilityManager</span><span class="p">[</span><span class="s2">&#34;getEnabledAccessibilityServiceList&#34;</span><span class="p">].</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">ArrayList</span><span class="p">.</span><span class="nx">$new</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nx">Global</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;android.provider.Settings$Global&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Global</span><span class="p">[</span><span class="s2">&#34;getInt&#34;</span><span class="p">].</span><span class="nx">overload</span><span class="p">(</span><span class="s2">&#34;android.content.ContentResolver&#34;</span><span class="p">,</span> <span class="s2">&#34;java.lang.String&#34;</span><span class="p">,</span> <span class="s2">&#34;int&#34;</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">cr</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">let</span> <span class="nx">ret</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="s2">&#34;getInt&#34;</span><span class="p">](</span><span class="nx">cr</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">s</span> <span class="o">===</span> <span class="s2">&#34;adb_enabled&#34;</span> <span class="o">||</span> <span class="nx">s</span> <span class="o">===</span> <span class="s2">&#34;adb_wifi_enabled&#34;</span> <span class="o">||</span> <span class="nx">s</span> <span class="o">===</span> <span class="s2">&#34;development_settings_enabled&#34;</span> <span class="o">||</span> <span class="nx">s</span> <span class="o">===</span> <span class="s2">&#34;device_provisioned&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;hook usb&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nx">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nx">Secure</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;android.provider.Settings$Secure&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Secure</span><span class="p">[</span><span class="s2">&#34;getInt&#34;</span><span class="p">].</span><span class="nx">overload</span><span class="p">(</span><span class="s2">&#34;android.content.ContentResolver&#34;</span><span class="p">,</span> <span class="s2">&#34;java.lang.String&#34;</span><span class="p">,</span> <span class="s2">&#34;int&#34;</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">cr</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">let</span> <span class="nx">ret</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="s2">&#34;getInt&#34;</span><span class="p">](</span><span class="nx">cr</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">s</span> <span class="o">===</span> <span class="s2">&#34;adb_enabled&#34;</span> <span class="o">||</span> <span class="nx">s</span> <span class="o">===</span> <span class="s2">&#34;adb_wifi_enabled&#34;</span> <span class="o">||</span> <span class="nx">s</span> <span class="o">===</span> <span class="s2">&#34;development_settings_enabled&#34;</span> <span class="o">||</span> <span class="nx">s</span> <span class="o">===</span> <span class="s2">&#34;device_provisioned&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;hook usb&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nx">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;[ * ] USB调试检测Hook完成&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="18-hook-动态加载的类dex">
<a class="header-anchor" href="#18-hook-%e5%8a%a8%e6%80%81%e5%8a%a0%e8%bd%bd%e7%9a%84%e7%b1%bbdex"></a>
1.8. hook 动态加载的类dex
</h3><p>可以 hook 动态加载的 inMemoryClassloder 加载的方法</p>
        
        <hr><p>本文2025-11-17首发于<a href='https://asu1tty.github.io/'>Asu1tty's Blog</a>，最后修改于2025-11-17</p>]]>
      </description>
      
        <category>Scripts</category>
      
    </item>
    
  </channel>
</rss>
